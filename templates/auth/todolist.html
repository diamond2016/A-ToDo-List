{% extends "base.html" %}
{% block title %}{{ title | default('Create To-Do List') }}{% endblock %}

{% block content %}
<style>
    .todolist-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }
    .todolist-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .item-row {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: box-shadow 0.3s ease;
    }
    .item-row:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .item-icon {
        width: 40px;
        text-align: center;
    }
    .delete-btn {
        color: #dc3545;
        cursor: pointer;
        transition: color 0.2s;
    }
    .delete-btn:hover {
        color: #a71d2a;
    }
    .action-buttons {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        justify-content: center;
    }
    .btn-add-item {
        background-color: #28a745;
        border-color: #28a745;
    }
    .btn-add-item:hover {
        background-color: #218838;
        border-color: #1e7e34;
    }
    .item-field {
        margin-bottom: 10px;
    }
    .readonly-item {
        background-color: #f8f9fa;
    }
</style>

<div class="todolist-container">
    <div class="todolist-header">
        <h2 class="mb-0"><i class="fas fa-tasks"></i> {{ title | default('Create To-Do List') }}</h2>
    </div>

    <form method="POST" action="" id="todolist-form">
        {{ form.hidden_tag() }}
        
        <!-- ToDo List Title -->
        <div class="mb-4">
            <label for="{{ form.name.id }}" class="form-label fs-5 fw-bold">
                <i class="fas fa-heading"></i> {{ form.name.label.text }}
            </label>
            {{ form.name(class="form-control form-control-lg", placeholder="Enter your to-do list title") }}
            {% if form.name.errors %}
                <div class="text-danger">
                    {% for error in form.name.errors %}
                        <small>{{ error }}</small>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- ToDo List Items -->
        <div id="items-container">
            {% for item_form in form.items %}
                <div class="item-row {% if readonly and item_form.completed.data %}readonly-item{% endif %}" data-item-index="{{ loop.index0 }}">
                    <div class="row align-items-center">
                        <!-- Icon -->
                        <div class="col-md-1 item-icon">
                            <i class="fas fa-circle-notch fa-lg text-primary"></i>
                            {{ item_form.icon_url(class="form-control form-control-sm d-none", placeholder="Icon URL") }}
                        </div>

                        <!-- Title -->
                        <div class="col-md-3 item-field">
                            {{ item_form.title(class="form-control", placeholder="Item title", readonly=readonly) }}
                        </div>

                        <!-- Content -->
                        <div class="col-md-3 item-field">
                            {{ item_form.content(class="form-control", placeholder="Item description", readonly=readonly) }}
                        </div>

                        <!-- Due Time -->
                        <div class="col-md-2 item-field">
                            {{ item_form.due_time(class="form-control", readonly=readonly) }}
                        </div>

                        <!-- Completed Checkbox -->
                        <div class="col-md-2 text-center">
                            <div class="form-check">
                                {{ item_form.completed(class="form-check-input", disabled=readonly) }}
                                <label class="form-check-label" for="{{ item_form.completed.id }}">
                                    Completed
                                </label>
                            </div>
                        </div>

                        <!-- Delete Button -->
                        <div class="col-md-1 text-end">
                            {% if not readonly or (readonly and not item_form.completed.data) %}
                                <i class="fas fa-times delete-btn" onclick="deleteItem(this)" title="Delete item"></i>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Action Buttons -->
        {% if not readonly %}
        <div class="action-buttons">
            <button type="button" class="btn btn-add-item btn-lg" onclick="addItem()">
                <i class="fas fa-plus"></i> Add Item
            </button>
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i> {{ form.submit.label.text }}
            </button>
        </div>
        {% endif %}
    </form>
</div>

<script>
    let itemIndex = {{ form.items | length }};

    function addItem() {
        const container = document.getElementById('items-container');
        const newItem = `
            <div class="item-row" data-item-index="${itemIndex}">
                <div class="row align-items-center">
                    <div class="col-md-1 item-icon">
                        <i class="fas fa-circle-notch fa-lg text-primary"></i>
                        <input class="form-control form-control-sm d-none" id="items-${itemIndex}-icon_url" name="items-${itemIndex}-icon_url" placeholder="Icon URL" type="text" value="">
                    </div>
                    <div class="col-md-3 item-field">
                        <input class="form-control" id="items-${itemIndex}-title" name="items-${itemIndex}-title" placeholder="Item title" required type="text" value="">
                    </div>
                    <div class="col-md-3 item-field">
                        <input class="form-control" id="items-${itemIndex}-content" name="items-${itemIndex}-content" placeholder="Item description" type="text" value="">
                    </div>
                    <div class="col-md-2 item-field">
                        <input class="form-control" id="items-${itemIndex}-due_time" name="items-${itemIndex}-due_time" type="datetime-local" value="">
                    </div>
                    <div class="col-md-2 text-center">
                        <div class="form-check">
                            <input class="form-check-input" id="items-${itemIndex}-completed" name="items-${itemIndex}-completed" type="checkbox" value="y">
                            <label class="form-check-label" for="items-${itemIndex}-completed">
                                Completed
                            </label>
                        </div>
                    </div>
                    <div class="col-md-1 text-end">
                        <i class="fas fa-times delete-btn" onclick="deleteItem(this)" title="Delete item"></i>
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', newItem);
        itemIndex++;
    }

    function deleteItem(element) {
        const itemRow = element.closest('.item-row');
        itemRow.remove();
    }
</script>
{% endblock %}
